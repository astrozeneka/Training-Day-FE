<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Mon profil</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <form [formGroup]="form">

    <div class="profile-image-container">
      <ion-avatar>
        <img *ngIf="!profile_image && entity?.profile_image?.permalink"
          [src]="getStaticUrl(entity?.profile_image?.permalink)"
             alt="Profile picture"
        />
        <img *ngIf="!profile_image && !entity?.profile_image?.permalink" src="/assets/samples/profile-default-01.png" alt="Profile image"/>
        <img *ngIf="profile_image" [src]="profile_image.base64" alt="Profile image"/>
      </ion-avatar>
      <input type="file"
             name="profile_image"
             style="display: none"
             #fileInput
             (change)="handleFileInput($event)"
      />
      <ion-button size="small" color="medium" (click)="selectImage()">
        Upload profile picture
        <ion-icon slot="end" name="cloud-upload-outline"></ion-icon>
      </ion-button>
    </div>

      <form [formGroup]="form">
          <ion-item>
              <ion-input
                      label="Prénom"
                      label-placement="floating"
                      formControlName="firstname"
                      [errorText]="displayedError.firstname"
              ></ion-input>
          </ion-item>
          <ion-item>
              <ion-input
                      label="Nom"
                      label-placement="floating"
                      formControlName="lastname"
                      [errorText]="displayedError.lastname"
              ></ion-input>
          </ion-item>
          <ion-item>
              <!-- The email cannot be updated -->
              <ion-input
                      label="Email"
                      label-placement="floating"
                      formControlName="email"
                      [errorText]="displayedError.email"
                      readonly
              ></ion-input>
          </ion-item>
          <ion-item>
              <ion-input
                      type="password"
                      label="Changer l'ancien mot de passe"
                      label-placement="floating"
                      formControlName="password"
                      [errorText]="displayedError.password"
              ></ion-input>
          </ion-item>
          <ion-item>
              <ion-input
                      type="password"
                      label="Confirmez le mot de passe"
                      label-placement="floating"
                      formControlName="password_confirm"
                      [errorText]="displayedError.password_confirm"
              ></ion-input>
          </ion-item>
          <ion-item>
              <ion-input
                      label="Téléphone"
                      label-placement="floating"
                      formControlName="phone"
                      [errorText]="displayedError.phone"
              ></ion-input>
          </ion-item>
          <ion-item>
              <ion-input
                      label="Adresse"
                      label-placement="floating"
                      formControlName="address"
                      [errorText]="displayedError.address"
              ></ion-input>
          </ion-item>
      </form>

    <div class="ion-padding ion-text-center">
      <ion-button (click)="submit()">Mettre à jour</ion-button>
    </div>
  </form>

    <div *ngIf="entity">
        <h3 class="display-1 ion-padding">Abonnement</h3>
        <ion-item *ngIf="!entity.subscription">
            Vous n'avez pas d'abonnement aux offres premium.
            <ion-button slot="end" color="primary" (click)="navigate('/subscriptions')">Souscrire</ion-button>
        </ion-item>
        <ion-item *ngIf="entity.subscription">
            <ion-label>Abonnement {{ entity.subscription.label }}</ion-label>
            <ion-note slot="end">Expiré le {{ entity.expires_at }}</ion-note>
        </ion-item>
    </div>

    <div class="ion-padding">
        <h3 class="display-1">Suppression du compte</h3>
        <p>
            Vous pouvez supprimer votre compte à tout moment. Cette action est irréversible.
        </p>
        <div class="ion-text-center">
            <ion-button (click)="deleteAccount()" color="danger">Supprimer mon compte</ion-button>
        </div>
    </div>

</ion-content>
