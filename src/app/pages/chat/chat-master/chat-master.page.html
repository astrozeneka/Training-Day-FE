<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
        <app-back-button></app-back-button>
        <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Messagerie</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="">
  <!-- This section should be infinite scroll -->
    <div *ngIf="user?.function !== 'customer'">
        <ion-item>
            <ion-label slot="start">
                Statut
            </ion-label>
            <ion-badge slot="end" color="success" *ngIf="isOnline">En ligne</ion-badge>
            <ion-badge slot="end" color="medium" *ngIf="!isOnline">Hors ligne</ion-badge>
        </ion-item>
        <ion-item>
            <ion-label>
                Je ne suis pas disponible
            </ion-label>
            <ion-toggle slot="end"></ion-toggle>
        </ion-item>
        <ion-searchbar [formControl]="searchControl"
                       animated="true"
                       placeholder="Rechercher"></ion-searchbar>

        <ion-radio-group *ngIf="user.function === 'coach'" [formControl]="displayMessageForForm">
            <ion-row>
                <ion-col size="6">
                    <ion-item>
                        <ion-label>Coaches</ion-label>
                        <ion-radio value="coach"></ion-radio>
                    </ion-item>
                </ion-col>
                <ion-col size="6">
                    <ion-item>
                        <ion-label>Nutritionnistes</ion-label>
                        <ion-radio value="nutritionnist"></ion-radio>
                    </ion-item>
                </ion-col>
            </ion-row>
        </ion-radio-group>

        <div class="ion-text-center">
            <ion-spinner *ngIf="!entityList" class="ion-padding" style="padding-top: 20vh"></ion-spinner>
        </div>
        <div *ngIf="entityList">
            <ion-item
                    *ngFor="let entity of entityList"
                    (click)="navigateToChatDetails(entity.id)"
                    style="cursor:pointer"
            >
                <ion-avatar slot="start">
                    <img src="{{entity.avatar_url ?? '../../../assets/samples/profile-sample-1.jpg'}}" alt="Profile Picture">
                </ion-avatar>
                {{ entity.firstname }} {{ entity.lastname === '_' ? '': entity.lastname }}
                <ion-badge *ngIf="entity.renewable_id" color="warning">
                    {{ entity.renewable_id }}
                </ion-badge>
                <ion-chip *ngIf="entity.unread" color="danger" slot="end">{{ entity.unread }}</ion-chip>
            </ion-item>
        </div>
    </div>
    <div *ngIf="user?.function === 'customer'" class="ion-padding-vertical">


        <!-- this 'subscription_is_active' is not used anymore -->
        <!--
        <h2 class="display-1 ion-padding-horizontal">Discuter avec mon coach</h2>
        <div *ngIf="user?.subscription_is_active || user.trial_is_active">
            <p class="helper ion-padding-horizontal">
                Vous pouvez discuter avec votre coach à tout moment. Il vous répondra dans les plus brefs délais.
            </p>
            <ion-card color="warning" class="ion-padding" *ngIf="user.trial_is_active && !(user.subscription_is_active || (user.grouped_perishables && user.grouped_perishables['sport-coach']) || (user.grouped_perishables && user.grouped_perishables['food-coach']))">
                Vous disposez d'un essai gratuit de 5 jours. Profitez-en pour discuter avec votre coach.
                L'essai se terminera le {{ user.trial_expires_at | date: 'dd/MM/yyyy' }}.
            </ion-card>
            <div *ngIf="coachList">
                <ion-item
                        *ngFor="let entity of coachList"
                        (click)="navigateTo('/chat/details/' + entity.id)"
                        style="cursor:pointer"
                >
                    <ion-avatar slot="start">
                        <img src="{{entity.avatar_url ?? '../../../assets/samples/profile-sample-1.jpg'}}" alt="Profile Picture">
                    </ion-avatar>
                    {{ entity.firstname }} {{ entity.lastname === '_' ? '': entity.lastname }}
                    <ion-badge *ngIf="entity.isActive" color="success">En ligne</ion-badge>
                    <ion-chip *ngIf="entity.unread" color="danger" slot="end">{{ entity.unread }}</ion-chip>
                </ion-item>
            </div>
            <div *ngIf="!coachList || coachList.length == 0">
                <p class="ion-text-center">
                    <ion-spinner></ion-spinner>
                </p>
            </div>
        </div>
        <div *ngIf="!user.subscription_is_active && !user.trial_is_active">
            <p class="helper ion-padding-horizontal">
                Vous n'avez pas accès à cette fonctionnalité. Veuillez souscrire à un Pack Moreno ou Alonzo pour en bénéficier.
            </p>
        </div>
        -->

        <h2 class="display-1 ion-padding-horizontal">Discuter avec mon coach</h2>
        <div>
            <p class="helper ion-padding-horizontal" *ngIf="(user?.renewable_id == null || user?.renewable_id == 'hoylt') && !grouped_perishables['sport-coach']">
                Vous disposez d'un accès limité à cette fonctionnalité. Veuillez souscrire à un Pack Hoylt pour en bénéficier.
            </p>
            <p class="helper ion-padding-horizontal" *ngIf="user?.renewable_id == 'moreno' || user?.renewable_id == 'alonzo' || grouped_perishables['sport-coach']">
                Vous pouvez discuter avec votre coach à tout moment. Il vous répondra dans les plus brefs délais.
            </p>
            <div *ngIf="coachList" class="discussion-list">
                <ion-item
                        *ngFor="let entity of coachList"
                        (click)="navigateTo('/chat/details/' + entity.id)"
                        style="cursor:pointer"
                >
                    <ion-avatar slot="start">
                        <img src="{{entity.avatar_url ?? '../../../assets/samples/profile-sample-1.jpg'}}" alt="Profile Picture">
                    </ion-avatar>
                    {{ entity.firstname }} {{ entity.lastname === '_' ? '': entity.lastname }}
                    <ion-badge *ngIf="entity.isActive" color="success">En ligne</ion-badge>
                    <ion-chip *ngIf="entity.unread" color="danger" slot="end">{{ entity.unread }}</ion-chip>
                </ion-item>
                <!-- The disabled message should be reviewed in the settings -->
                <div class="placeholder" *ngIf="user?.user_settings?.disable_coach_messages == 'true'">
                    <div class="helper">Votre accès à la messagerie est désactivé.</div>
                </div>
            </div>
            <div *ngIf="!coachList || coachList.length == 0">
                <p class="ion-text-center">
                    <ion-spinner></ion-spinner>
                </p>
            </div>
        </div>

        <br/><br/>
        <h2 class="display-1 ion-padding-horizontal">Discuter avec mon nutrionniste</h2>
        <div>
            <p class="helper ion-padding-horizontal" *ngIf="(user?.renewable_id == null) && !grouped_perishables['food-coach']">
                Vous n'avez pas accès à cette fonctionnalité. Veuillez souscrire à un Pack Alonzo pour en bénéficier.
            </p>
            <p class="helper ion-padding-horizontal" *ngIf="(user?.renewable_id == 'hoylt' || user?.renewable_id == 'moreno') && !grouped_perishables['food-coach']">
                Vous disposez d'un accès limité à cette fonctionnalité. Veuillez souscrire à un Pack Alonzo pour en bénéficier.
            </p>
            <p class="helper ion-padding-horizontal" *ngIf="user?.renewable_id == 'alonzo' || grouped_perishables['food-coach']">
                Vous pouvez discuter avec votre nutrionniste à tout moment. Il vous répondra dans les plus brefs délais.
            </p>
            <div *ngIf="nutritionistList && !((user?.renewable_id == null) && !grouped_perishables['food-coach'])" class="discussion-list">
                <ion-item
                        *ngFor="let entity of nutritionistList"
                        (click)="navigateTo('/chat/details/' + entity.id)"
                        style="cursor:pointer"
                >
                    <ion-avatar slot="start">
                        <img src="{{entity.avatar_url ?? '../../../assets/samples/profile-sample-1.jpg'}}" alt="Profile Picture">
                    </ion-avatar>
                    {{ entity.firstname }} {{ entity.lastname === '_' ? '': entity.lastname }}
                    <ion-badge *ngIf="entity.isActive" color="success">En ligne</ion-badge>
                    <ion-chip *ngIf="entity.unread" color="danger" slot="end">{{ entity.unread }}</ion-chip>
                </ion-item>
                <!-- TODO -->
                <!-- The disabled message should be reviewed in the settings -->
                <div class="placeholder" *ngIf="user?.user_settings?.disable_nutritionist_messages == 'true'">
                    <div class="helper">Votre accès à la messagerie est désactivé.</div>
                </div>
            </div>
            <div *ngIf="(!nutritionistList || nutritionistList.length == 0) && !(user?.renewable_id == null)">
                <p class="ion-text-center">
                    <ion-spinner></ion-spinner>
                </p>
            </div>
        </div>
        <!-- The variable has been changed from subscription.slug to just renewable_id -->
        <!--
        <div *ngIf="user?.renewable_id === 'alonzo'"> 
            <p class="helper ion-padding-horizontal">
                Vous pouvez discuter avec votre nutrionniste à tout moment. Il vous répondra dans les plus brefs délais.
            </p>
            <div *ngIf="nutritionistList">
                <ion-item
                        *ngFor="let entity of nutritionistList"
                        (click)="navigateTo('/chat/details/' + entity.id)"
                        style="cursor:pointer"
                >
                    <ion-avatar slot="start">
                        <img src="{{entity.avatar_url ?? '../../../assets/samples/profile-sample-1.jpg'}}" alt="Profile Picture">
                    </ion-avatar>
                    {{ entity.firstname }} {{ entity.lastname === '_' ? '': entity.lastname }}
                    <ion-badge *ngIf="entity.isActive" color="success">En ligne</ion-badge>
                    <ion-chip *ngIf="entity.unread" color="danger" slot="end">{{ entity.unread }}</ion-chip>
                </ion-item>
            </div>
        </div>
        <div *ngIf="user?.renewable_id !== 'alonzo'">
            <p class="helper ion-padding-horizontal">
                Vous n'avez pas accès à cette fonctionnalité. Veuillez souscrire à un Pack Alonzo pour en bénéficier.
            </p>
        </div>
        -->
    </div>

  <!-- No fab -->

</ion-content>
